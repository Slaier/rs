# 以太网 :id=ethernet

---

## MAC :id=mac

MAC地址共48位（6个字节），以十六进制表示。前24位由IEEE决定如何分配，后24位由实际生产该网络设备的厂商自行指定。

`ff:ff:ff:ff:ff:ff`则作为广播地址。

`01:xx:xx:xx:xx:xx`是多播地址，`01:00:5e:xx:xx:xx`是IPv4多播地址。

---

## 以太网帧 :id=ethernet-frame

Ethernet II, IEEE 802.Q.

|   DA    |   SA    |  Type   |    PayLoad    |   FCR   |
| :-----: | :-----: | :-----: | :-----------: | :-----: |
| 6 Bytes | 6 Bytes | 2 Bytes | 46~1500 Bytes | 4 Bytes |

+ `DA`(Desstination Address): 目标节点的`MAC`地址
+ `SA`(Source Address): 源节点的`MAC`地址
+ `Type`: 指示`PayLoad`的类型
+ `PayLoad`: 上层协议有效载荷
+ `FCR`: 4字节的校验和

以太网中，最小帧长为64字节，这是由最大传输距离和冲突检测机制共同决定的。

### *前导码* :id=preamble
`Preamble`(7 Bytes)/`SFD`(1 Bytes, Start-of-Frame Delimiter)：每个以太网帧发送时都是以8个字节的前导码开始, `Preamble`是1和0交替（1 0 1 0 1 0 ...）的7个字节数据, 该部分的作用是通知接收方有数据帧到来, 使其与输入的时钟保持同步, 56bit 模式容许站点在帧的开始可以丢弃一些bit. `SFD`是一个字节10101011, 最后使用11, 来通知接收方下一字段就是目的主机的地址了. 实际上前导码都是在物理层加进去的, 并不是帧的一部分.

### *帧间隙* :id=inter-frame-gap

以太网传送数据时, 每两个帧之间存在帧间隙`IFG`(Inter Frame Gap)，帧间隙的作用是使介质中的信号处于稳定状态，同时让帧接收者对接收的帧作必要的处理(如调整缓存取的指针、更新计数、发中断让主机对报文进行处理), 通常为8或12字节.

---

## 以太网速率 :id=ethernet-speed

### *BPS* :id=bps
我们通常所说的100M、1000M(`GE`)、10GE(`XGE`), 这些都是指理论上物理介质每秒可以传送多少bit的数据, 即`BPS`(bytes per second).

### *PPS* :id=pps
在我们实际中经常使用每秒传送实际数据帧的数目即`PPS`(packets per second)来表示报文的速率, `PPS`标志了交换机转发数据包能力的大小.

### *速率转换* :id=speed-transform
假设数据帧的长度为 $k$ Bytes(包括CRC), 端口速率为$R$, 转化后的PPS为$N$, 那么: $N=\frac{R}{8*(k+8+12)}$.

### *线速转发* :id=line-speed-forwarding
端口在满负载的情况下, 对帧进行无差错的转发称为线速转发(一般是指64字节的小包).

交换机的背板带宽，是交换机接口处理器或接口卡和数据总线间所能吞吐的最大数据量。背板带宽标志了交换机总的数据交换能力，单位为`Gbps`，也叫交换带宽，一台交换机的背板带宽越高，表示能处理数据的能力越强。

---

## 双工模式 :id=duplex

### *半双工* :id=half-duplex
任意时刻只能接收数据或者发送数据。

### *全双工* :id=full-duplex
同一时刻可以接收和发送数据。

### *冲突域* :id=collision
在传统的以粗同轴电缆为传输介质的以太网中，同一介质上的多个节点共享链路的带宽，争用链路的使用权，这样就会发生冲突。这种连接在同一导线上的所有节点的集合就是一个冲突域。

---

## 自协商 :id=auto-negotiation

IEEE 802.3u，IEEE 802.3z

自动协商的内容主要包括双工模式、运行速率、流控等内容，一旦协商通过，链路两端的设备就锁定在这样一种运行模式下。

