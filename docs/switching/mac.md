# MAC :id=mac

---

## MAC简介 :id=mac-introduction

MAC地址共48位（6个字节），以十六进制表示。前24位由IEEE决定如何分配，后24位由实际生产该网络设备的厂商自行指定。

`ff:ff:ff:ff:ff:ff`则作为广播地址，`01:xx:xx:xx:xx:xx`是多播地址，`01:00:5e:xx:xx:xx`是IPv4多播地址。

---

## MAC学习 :id=mac-learn

MAC学习是基于帧的`源MAC`学习的。

HostA向SwitchA发送数据时，SwitchA从数据帧中解析出源MAC地址（即HostA的MAC地址）和VLAN ID。

+ 如果MAC地址表中不存在该MAC地址表项，设备则将这个新MAC地址以及该MAC地址对应的PortA和VLAN ID作为一个新的表项加入到MAC地址表中。
+ 如果MAC地址表中已经存在该MAC地址表项，设备将通过重置该表项的老化时间，对该表项进行更新。

---

## MAC老化 :id=mac-aging

由于MAC地址表的表项数目有限，所以需要进行老化。

+ 收到`源MAC`匹配的帧后，将表项的hit标记为`1`

设备周期性地对所有学习到的动态MAC地址表项进行检查。

+ 若hit位为`1`，则修改为`0`
+ 若hit位为`0`，则老化删除

MAC老化周期检测时间默认为`300`s.

---

## MAC表项分类 :id=mac-entry-classify

+ 动态表项
  + 由接口通过报文中的源MAC地址学习获得，表项可老化
  + 在系统复位、接口板热插拔或接口板复位后，动态表项会丢失
+ 静态表项
  + 由用户手工配置，并下发到各接口板，表项不可老化
  + 在系统复位、接口板热插拔或接口板复位后，保存的表项不会丢失
  + 接口和MAC地址静态绑定后，其他接口收到源MAC是该MAC地址的报文将会被丢弃
+ 黑洞表项
  + 由用户手工配置，并下发到各接口板，表项不可老化
  + 在系统复位、接口板热插拔或接口板复位后，保存的表项不会丢失
  + 源MAC地址或目的MAC地址是该MAC的报文将会被丢弃

!>具体分类及名称可能会有差异

---

## MAC学习关闭 :id=mac-disable-learn

+ 全局开关：关闭后全局不进行MAC学习，默认disable
+ 接口开关：控制该接口的MAC学习，默认enable

---

## MAC地址漂移 :id=mac-station-move

MAC地址漂移是指设备上一个VLAN内有两个端口学习到同一个MAC地址，后学习到的MAC地址表项覆盖原MAC地址表项的现象，出现这种现象一般都意味着网络中存在环路。

+ 解决手段
  + 设置静态MAC
  + 为MAC设置优先级，禁止高优先级向低优先级漂移
  + 不允许相同优先级之间进行漂移